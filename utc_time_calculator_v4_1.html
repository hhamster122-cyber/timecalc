<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Time Converter</title>
  <style>
    :root { --bg:#f8fafc; --fg:#0f172a; --muted:#64748b; --card:#fff; --br:#e2e8f0; }
    * { box-sizing:border-box; }
    body { margin:0; font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:#0f172a; }
    .wrap { max-width:960px; margin:0 auto; padding:24px; }
    header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
    h1 { font-size:24px; margin:0; }
    .note { color:var(--muted); margin:4px 0 16px; font-size:14px; }
    .grid { display:grid; gap:16px; grid-template-columns:1fr; }
    @media (min-width:860px){ .grid{ grid-template-columns:1fr 1fr; } }
    .card { background:#fff; border:1px solid var(--br); border-radius:16px; padding:16px; }
    label { display:block; font-weight:600; margin:0 0 8px; font-size:14px; }
    input[type="text"], select.lang { width:100%; border:1px solid var(--br); border-radius:12px; padding:10px 12px; font-size:16px; }
    .row { display:flex; gap:8px; align-items:center; }
    .btn { border:1px solid var(--br); background:#fff; border-radius:12px; padding:8px 12px; font-size:14px; cursor:pointer; }
    .btn:hover { background:#f1f5f9; }
    .zones { height:200px; overflow:auto; border:1px solid var(--br); border-radius:12px; }
    .zones button { display:block; width:100%; border:0; background:transparent; text-align:left; padding:8px 12px; font-size:14px; cursor:pointer; }
    .zones button:hover { background:#f8fafc; }
    .zones button.active { background:#eef2ff; font-weight:600; }
    .cols3 { display:grid; gap:16px; grid-template-columns:1fr; margin-top:16px; }
    @media (min-width:860px){ .cols3{ grid-template-columns:1fr 1fr 1fr; } }
    .muted { color:var(--muted); font-size:13px; }
    .big { font-size:20px; font-weight:700; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .break { word-break:break-all; }
    .pill { display:inline-block; font-size:12px; padding:2px 8px; background:#eef2ff; color:#1f2a6b; border-radius:999px; margin-left:8px; }
    .warn { color:#b91c1c; }
  </style>
</head>
<body>
  <main class="wrap">
    <header>
      <div>
        <h1 id="title">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤—Ä–µ–º–µ–Ω–∏: UTC ‚Üí –≤–∞—à —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å</h1>
        <div id="note" class="note">–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É/–≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ <b>–î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú</b> –ø–æ UTC –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å.</div>
      </div>
      <div style="min-width:210px;">
        <select id="lang" class="lang">
          <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
          <option value="en">üá¨üáß English</option>
          <option value="es">üá™üá∏ Espa√±ol</option>
          <option value="it">üáÆüáπ Italiano</option>
          <option value="nl">üá≥üá± Nederlands</option>
        </select>
      </div>
    </header>

    <section class="grid">
      <div class="card">
        <label id="label_input">–í—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è (UTC) <span class="pill">–î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú</span></label>
        <input id="utcInput" type="text" inputmode="numeric" placeholder="01.12.2025 18:30" />
        <p id="hint_input" class="muted">–ü—Ä–∏–º–µ—Ä: <span class="mono">05.11.2025 14:00</span>. –ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å ISO <span class="mono">2025-11-05T14:00</span> ‚Äî —Ç–æ–∂–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è.</p>
        <p id="input_err" class="muted warn" style="display:none;"></p>
      </div>

      <div class="card">
        <label id="label_tz">–í–∞—à —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å</label>
        <div class="row" style="margin-bottom:8px;">
          <input id="tzSearch" type="text" placeholder="–ü–æ–∏—Å–∫ (Europe/Moscow, America/New_York‚Ä¶)" />
          <button class="btn" id="btnAuto">–ê–≤—Ç–æ</button>
        </div>
        <div class="zones" id="zoneList"></div>
      </div>
    </section>

    <section class="cols3">
      <div class="card">
        <div id="label_result" class="muted">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
        <div id="outLocal" class="big" aria-live="polite">‚Äî</div>
        <div id="outTz" class="muted mono"></div>
      </div>
      <div class="card">
        <div id="label_relative" class="muted">–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–µ–π—á–∞—Å</div>
        <div id="outRel" class="big" aria-live="polite">‚Äî</div>
        <div class="muted"><span id="label_now">–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:</span> <span id="outNow"></span></div>
      </div>
      <div class="card">
        <div id="label_share" class="muted">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</div>
        <div id="share" class="mono break" style="margin:8px 0 8px;"></div>
        <div class="row">
          <button class="btn" id="btnCopy">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
          <button class="btn" id="btnOpen">–û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    const SUPPORTED = ['ru','en','es','it','nl'];
    const DICT = {
      ru: {
        title: "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤—Ä–µ–º–µ–Ω–∏: UTC ‚Üí –≤–∞—à —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å",
        note: "–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É/–≤—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú –ø–æ UTC –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å.",
        input_label: "–í—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è (UTC)",
        input_hint: "–ü—Ä–∏–º–µ—Ä: 05.11.2025 14:00. –ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å ISO 2025-11-05T14:00 ‚Äî —Ç–æ–∂–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç—Å—è.",
        input_err: "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –¥–∞—Ç—É/–≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú (UTC).",
        tz_label: "–í–∞—à —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å",
        search_placeholder: "–ü–æ–∏—Å–∫ (Europe/Moscow, America/New_York‚Ä¶)",
        auto_btn: "–ê–≤—Ç–æ",
        result: "–†–µ–∑—É–ª—å—Ç–∞—Ç",
        relative: "–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–µ–π—á–∞—Å",
        current_time: "–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è:",
        share: "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è",
        copy: "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É",
        open: "–û—Ç–∫—Ä—ã—Ç—å",
      },
      en: {
        title: "Time Converter: UTC ‚Üí your time zone",
        note: "Enter UTC event time in format DD.MM.YYYY HH:mm and choose your time zone.",
        input_label: "Event time (UTC)",
        input_hint: "Example: 05.11.2025 14:00. ISO like 2025-11-05T14:00 is also accepted.",
        input_err: "Please enter a valid UTC date/time DD.MM.YYYY HH:mm.",
        tz_label: "Your time zone",
        search_placeholder: "Search (Europe/Moscow, America/New_York‚Ä¶)",
        auto_btn: "Auto",
        result: "Result",
        relative: "Relative to now",
        current_time: "Current time:",
        share: "Share",
        copy: "Copy link",
        open: "Open",
      },
      es: {
        title: "Conversor de hora: UTC ‚Üí tu zona horaria",
        note: "Introduce la hora del evento en UTC con formato DD.MM.YYYY HH:mm y elige tu zona horaria.",
        input_label: "Hora del evento (UTC)",
        input_hint: "Ejemplo: 05.11.2025 14:00. Tambi√©n se acepta ISO 2025-11-05T14:00.",
        input_err: "Introduce una fecha/hora UTC v√°lida DD.MM.YYYY HH:mm.",
        tz_label: "Tu zona horaria",
        search_placeholder: "Buscar (Europe/Moscow, America/New_York‚Ä¶)",
        auto_btn: "Auto",
        result: "Resultado",
        relative: "En relaci√≥n con ahora",
        current_time: "Hora actual:",
        share: "Compartir",
        copy: "Copiar enlace",
        open: "Abrir",
      },
      it: {
        title: "Convertitore orario: UTC ‚Üí il tuo fuso orario",
        note: "Inserisci l'orario UTC nel formato DD.MM.YYYY HH:mm e scegli il tuo fuso.",
        input_label: "Orario dell'evento (UTC)",
        input_hint: "Esempio: 05.11.2025 14:00. Accetta anche ISO 2025-11-05T14:00.",
        input_err: "Inserisci una data/ora UTC valida DD.MM.YYYY HH:mm.",
        tz_label: "Il tuo fuso orario",
        search_placeholder: "Cerca (Europe/Moscow, America/New_York‚Ä¶)",
        auto_btn: "Auto",
        result: "Risultato",
        relative: "Rispetto a ora",
        current_time: "Ora attuale:",
        share: "Condividi",
        copy: "Copia link",
        open: "Apri",
      },
      nl: {
        title: "Tijdconverter: UTC ‚Üí jouw tijdzone",
        note: "Voer de UTC-tijd in met formaat DD.MM.YYYY HH:mm en kies je tijdzone.",
        input_label: "Gebeurtenistijd (UTC)",
        input_hint: "Voorbeeld: 05.11.2025 14:00. ISO 2025-11-05T14:00 wordt ook geaccepteerd.",
        input_err: "Voer een geldige UTC-datum/tijd in DD.MM.YYYY HH:mm.",
        tz_label: "Jouw tijdzone",
        search_placeholder: "Zoeken (Europe/Moscow, America/New_York‚Ä¶)",
        auto_btn: "Auto",
        result: "Resultaat",
        relative: "Ten opzichte van nu",
        current_time: "Huidige tijd:",
        share: "Delen",
        copy: "Link kopi√´ren",
        open: "Openen",
      },
    };

    let state = {
      tz: getUserTZ(),
      utcText: "", // dd.MM.yyyy HH:mm (as entered)
      lang: getInitialLang(),
    };

    const $ = (id) => document.getElementById(id);

    function init(){
      const sel = $('lang');
      sel.value = state.lang;
      sel.addEventListener('change', ()=>{
        state.lang = sel.value;
        localStorage.setItem('calc_lang', state.lang);
        applyLang();
        update();
      });

      $('btnAuto').addEventListener('click', ()=>{ state.tz = getUserTZ(); markActiveTZ(); update(); });
      $('tzSearch').addEventListener('input', (e)=>{
        const q = e.target.value.trim().toLowerCase();
        renderZones(filterZones(q));
      });

      $('utcInput').addEventListener('input', (e)=>{
        state.utcText = e.target.value;
        update();
      });

      $('btnCopy').addEventListener('click', async ()=>{
        try { await navigator.clipboard.writeText(getShareURL()); } catch {}
      });
      $('btnOpen').addEventListener('click', ()=>{ window.open(getShareURL(), '_blank'); });

      renderZones(getAllZones());
      readQuery(); // may set state from ?utc=ISO
      $('utcInput').value = state.utcText;

      applyLang();
      update();
      setInterval(()=> updateNow(), 30*1000);
    }

    function getInitialLang(){
      const urlLang = new URL(location.href).searchParams.get('lang');
      if (urlLang && SUPPORTED.includes(urlLang)) return urlLang;
      const saved = localStorage.getItem('calc_lang');
      if (saved && SUPPORTED.includes(saved)) return saved;
      const browser = (navigator.language || 'ru').slice(0,2);
      return SUPPORTED.includes(browser) ? browser : 'ru';
    }

    function applyLang(){
      const t = DICT[state.lang];
      document.documentElement.lang = state.lang;
      document.title = t.title;

      $('title').textContent = t.title;
      $('note').textContent = t.note;

      $('label_input').innerHTML = `${t.input_label} <span class="pill">–î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú</span>`;
      $('hint_input').textContent = t.input_hint;
      $('input_err').style.display = 'none';
      $('input_err').textContent = t.input_err;

      $('label_tz').textContent = t.tz_label;
      $('tzSearch').placeholder = t.search_placeholder;
      $('btnAuto').textContent = `${t.auto_btn}: ${shortTZ(getUserTZ())}`;

      $('label_result').textContent = t.result;
      $('label_relative').textContent = t.relative;
      $('label_now').textContent = t.current_time;
      $('label_share').textContent = t.share;
      $('btnCopy').textContent = t.copy;
      $('btnOpen').textContent = t.open;
    }

    function filterZones(q){
      const zones = getAllZones();
      if (!q) return zones;
      return zones.filter(z => z.toLowerCase().includes(q));
    }

    function renderZones(list){
      const box = $('zoneList');
      box.innerHTML = '';
      list.forEach(z => {
        const b = document.createElement('button');
        b.textContent = z;
        b.className = (z===state.tz) ? 'active' : '';
        b.addEventListener('click', ()=>{ state.tz = z; markActiveTZ(); update(); });
        box.appendChild(b);
      });
    }

    function markActiveTZ(){
      [...$('zoneList').querySelectorAll('button')].forEach(b => {
        b.classList.toggle('active', b.textContent===state.tz);
      });
    }

    function readQuery(){
      const u = new URL(location.href);
      const qUtc = u.searchParams.get('utc');   // expected ISO
      const qTz = u.searchParams.get('tz');
      const qLang = u.searchParams.get('lang');
      if (qUtc) {
        const d = parseISOToUTC(qUtc);
        if (d) state.utcText = toDDMMYYYY_HHMM(d); // display in dd.MM.yyyy HH:mm
      }
      if (qTz && getAllZones().includes(qTz)) state.tz = qTz;
      if (qLang && SUPPORTED.includes(qLang)) state.lang = qLang;
      $('lang').value = state.lang;
    }

    function update(){
      const t = DICT[state.lang];
      const txt = state.utcText.trim();
      if (!txt){
        $('outLocal').textContent = '‚Äî';
        $('outRel').textContent = '‚Äî';
        $('outTz').textContent = state.tz;
        $('input_err').style.display = 'none';
      } else {
        const d = parseDDMMYYYY_HHMM_toDateUTC(txt) || parseISOToUTC(txt);
        if (!d){
          $('outLocal').textContent = '‚Äî';
          $('outRel').textContent = '‚Äî';
          $('outTz').textContent = state.tz;
          $('input_err').style.display = 'block';
          $('input_err').textContent = t.input_err;
        } else {
          $('input_err').style.display = 'none';
          $('outLocal').textContent = formatInTZ(d, state.tz, state.lang);
          $('outTz').textContent = state.tz;
          $('outRel').textContent = formatRelative(d, state.lang);
        }
      }
      updateNow();
      $('share').textContent = getShareURL();
      try { history.replaceState(null, '', getShareURL()); } catch (e) {}
    }

    function updateNow(){
      $('outNow').textContent = formatInTZ(new Date(), state.tz, state.lang);
    }

    // ===== Helpers =====
    function getUserTZ(){
      try { return Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC'; } catch { return 'UTC'; }
    }

    function getAllZones(){
      if (typeof Intl.supportedValuesOf === 'function') {
        const list = Intl.supportedValuesOf('timeZone');
        const user = getUserTZ();
        return [user, ...list.filter(z => z !== user)];
      }
      return ['UTC','Europe/Moscow','Europe/Amsterdam','Europe/Madrid','Europe/Rome','America/New_York','America/Chicago','Europe/London','America/Denver','America/Los_Angeles','Asia/Tokyo','Asia/Shanghai','Asia/Dubai','Australia/Sydney'];
    }

    function shortTZ(z){ const p=z.split('/'); return p[p.length-1]||z; }

    // Parse dd.MM.yyyy HH:mm as UTC Date
    function parseDDMMYYYY_HHMM_toDateUTC(txt){
      const s = txt.replace(/T/, ' ').replace(/\s+/, ' ').trim();
      const m = s.match(/^(\d{2})\.(\d{2})\.(\d{4})\s+(\d{2}):(\d{2})$/);
      if (!m) return null;
      const dd = Number(m[1]), MM = Number(m[2]), yyyy = Number(m[3]), hh = Number(m[4]), mm = Number(m[5]);
      if (MM<1||MM>12||dd<1||dd>31||hh>23||mm>59) return null;
      return new Date(Date.UTC(yyyy, MM-1, dd, hh, mm, 0, 0));
    }

    // Parse ISO YYYY-MM-DDTHH:mm as UTC Date
    function parseISOToUTC(txt){
      const s = txt.replace(' ', 'T').slice(0,16);
      if (!/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(s)) return null;
      const [d,t] = s.split('T');
      const [y,m,dd] = d.split('-').map(Number);
      const [hh,mm] = t.split(':').map(Number);
      return new Date(Date.UTC(y,(m||1)-1,dd||1,hh||0,mm||0,0,0));
    }

    function toDDMMYYYY_HHMM(date){
      const pad = (n)=> String(n).padStart(2,'0');
      const dd = pad(date.getUTCDate());
      const MM = pad(date.getUTCMonth()+1);
      const yyyy = date.getUTCFullYear();
      const hh = pad(date.getUTCHours());
      const mm = pad(date.getUTCMinutes());
      return `${dd}.${MM}.${yyyy} ${hh}:${mm}`;
    }

    function toISO_UTC_Min(date){
      const pad = (n)=> String(n).padStart(2,'0');
      const y = date.getUTCFullYear();
      const m = pad(date.getUTCMonth()+1);
      const d = pad(date.getUTCDate());
      const hh = pad(date.getUTCHours());
      const mm = pad(date.getUTCMinutes());
      return `${y}-${m}-${d}T${hh}:${mm}`;
    }

    function formatInTZ(date, tz, lang){
      try {
        return new Intl.DateTimeFormat(lang, { timeZone: tz, year:'numeric', month:'long', day:'2-digit', hour:'2-digit', minute:'2-digit', hour12:false, weekday:'short', timeZoneName:'short' }).format(date);
      } catch { return date.toUTCString(); }
    }

    function formatRelative(target, lang){
      const TABLE = {
        ru:{just_past:"—Ç–æ–ª—å–∫–æ —á—Ç–æ –±—ã–ª–æ", just_future:"—á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É", min_ago:n=>`${n} –º–∏–Ω –Ω–∞–∑–∞–¥`, in_min:n=>`—á–µ—Ä–µ–∑ ${n} –º–∏–Ω`, h_ago:n=>`${n} —á –Ω–∞–∑–∞–¥`, in_h:n=>`—á–µ—Ä–µ–∑ ${n} —á`, d_ago:n=>`${n} –¥–Ω –Ω–∞–∑–∞–¥`, in_d:n=>`—á–µ—Ä–µ–∑ ${n} –¥–Ω`},
        en:{just_past:"just now", just_future:"in a minute", min_ago:n=>`${n} min ago`, in_min:n=>`in ${n} min`, h_ago:n=>`${n} h ago`, in_h:n=>`in ${n} h`, d_ago:n=>`${n} d ago`, in_d:n=>`in ${n} d`},
        es:{just_past:"ahora mismo", just_future:"en un minuto", min_ago:n=>`${n} min atr√°s`, in_min:n=>`en ${n} min`, h_ago:n=>`${n} h atr√°s`, in_h:n=>`en ${n} h`, d_ago:n=>`${n} d atr√°s`, in_d:n=>`en ${n} d`},
        it:{just_past:"proprio ora", just_future:"tra un minuto", min_ago:n=>`${n} min fa`, in_min:n=>`tra ${n} min`, h_ago:n=>`${n} h fa`, in_h:n=>`tra ${n} h`, d_ago:n=>`${n} g fa`, in_d:n=>`tra ${n} g`},
        nl:{just_past:"zojuist", just_future:"over een minuut", min_ago:n=>`${n} min geleden`, in_min:n=>`over ${n} min`, h_ago:n=>`${n} u geleden`, in_h:n=>`over ${n} u`, d_ago:n=>`${n} d geleden`, in_d:n=>`over ${n} d`},
      };
      const R = TABLE[lang] || TABLE.en;
      const now = new Date();
      const diff = target.getTime() - now.getTime();
      const past = diff < 0; const abs = Math.abs(diff);
      const mins = Math.round(abs/60000);
      if (mins < 1) return past ? R.just_past : R.just_future;
      if (mins < 60) return past ? R.min_ago(mins) : R.in_min(mins);
      const h = Math.round(mins/60);
      if (h < 24) return past ? R.h_ago(h) : R.in_h(h);
      const d = Math.round(h/24);
      return past ? R.d_ago(d) : R.in_d(d);
    }

    function getShareURL(){
      const u = new URL(location.href);
      // Convert current input to ISO for share
      let d = parseDDMMYYYY_HHMM_toDateUTC(state.utcText) || parseISOToUTC(state.utcText);
      if (d) u.searchParams.set('utc', toISO_UTC_Min(d)); else u.searchParams.delete('utc');
      u.searchParams.set('tz', state.tz);
      u.searchParams.set('lang', state.lang);
      return u.toString();
    }

    // init
    init();
  </script>
</body>
</html>
